<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.renkaen.cat_hospital.mapper.StaffMapper">
    <resultMap id="staffJoinRights" type="com.renkaen.cat_hospital.bean.DTO.StaffJoinRightsDTO" autoMapping="true">
        <association property="rights" javaType="com.renkaen.cat_hospital.bean.DO.Rights" autoMapping="true"/>
    </resultMap>
    <!--根据权限id获取权限信息-->
    <select id="selectUserById" resultType="com.renkaen.cat_hospital.bean.DO.Staff">
        select *
        from staff_table
        where id = #{id};
    </select>
    <select id="selectAllUser" resultType="com.renkaen.cat_hospital.bean.DO.Staff">
        select *
        from staff_table
    </select>

    <!--查询用户名是否被占用-->
    <select id="selectStaffByName" resultType="com.renkaen.cat_hospital.bean.DO.Staff">
        select * from staff_table where username = #{username}
    </select>

    <!--获取所有医生-->
    <select id="selectUserByRole" resultType="com.renkaen.cat_hospital.bean.DO.Staff">
        select *
        from staff_table
        where rolesId = #{id_1} or rolesId = #{id_2};
    </select>
    <!--根据id获得staff join rights-->
    <select id="selectStaffByIdJoinRights" resultMap="staffJoinRights">
        select *
        from ( select * from staff_table where id = #{id}) staff left join rights_table rights
        on staff.rightsId = rights.id
    </select>
    <!--根据username, password获得staff join rights-->
    <select id="selectStaffByPassword" resultType="com.renkaen.cat_hospital.bean.DO.Staff" >
        select *
        from staff_table
        where username = #{username} and password = #{password}
    </select>

    <!--新增用户-->
    <insert id="insertUser" useGeneratedKeys="true" keyProperty="id">
        insert into staff_table (id, username, password, realName, keyTime, rolesId,showed, rightsId,intro,zaishoku,avatar )
        values (default, #{username}, #{password}, #{realName}, #{keyTime}, #{rolesId},#{showed},#{rightsId},#{intro},#{zaishoku},#{avatar})
    </insert>

    <update id="updateStaffById" parameterType="com.renkaen.cat_hospital.bean.DO.Staff">
        update staff_table
        set username =ifnull(#{staff.username}, username),
            password=ifnull(#{staff.password},password ),
            realName=ifnull(#{staff.realName}, realName),
            keyTime=ifnull(#{staff.keyTime},keyTime ),
            rolesId=ifnull(#{staff.rolesId}, rolesId),
            showed=ifnull(#{staff.showed},showed ),
            rightsId=ifnull(#{staff.rightsId},rightsId ),
            intro= ifnull(#{staff.intro}, intro),
            zaishoku= ifnull(#{staff.zaishoku},zaishoku ),
            avatar = ifnull(#{staff.avatar}, avatar )
        where id = #{id}
    </update>

    <delete id="deleteStaffById">
        delete from staff_table
        where id = #{id}
    </delete>




</mapper>